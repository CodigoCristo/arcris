#!/bin/bash

VM=false
    
while (true)
do
    
    case $(systemd-detect-virt) in
        oracle)
            virt="vbox"
            VM=true
        ;;
        vmware)
            virt="vmware"
            VM=true
        ;;
        qemu)
            virt="qemu"
            VM=true
        ;;
        kvm)
            virt="kvm"
            VM=true
        ;;
        microsoft)
            virt="hyper-v"
            VM=true
        ;;
        xen)
            virt="xen"
            VM=true
        ;;
    esac

if "$VM" ; then
            case "$virt" in
                vbox)   dialog --ok-button "$ok" --msgbox "\n$vbox_msg" 10 60
                        GPU="virtualbox-guest-utils "
                        if [ "$kernel" == "linux" ]; then
                            GPU+="virtualbox-guest-modules-arch "
                        else
                            GPU+="virtualbox-guest-dkms "
                        fi
                ;;
                vmware) dialog --ok-button "$ok" --msgbox "\n$vmware_msg" 10 60
                        GPU="xf86-video-vmware xf86-input-vmmouse open-vm-tools net-tools gtkmm mesa mesa-libgl"
                ;;
                hyper-v) dialog --ok-button "$ok" --msgbox "\n$hyperv_msg" 10 60
                         GPU="xf86-video-fbdev mesa-libgl"
                ;;
                *)      dialog --ok-button "$ok" --msgbox "\n$vm_msg" 10 60
                        GPU="xf86-video-fbdev mesa-libgl"
                ;;
            esac
            break
fi
done



        if (lspci | grep VGA | grep "NVIDIA" &>/dev/null); then
            NVIDIA=true default_GPU="xf86-video-nouveau"
            chipset="Nvidia"
            echo "NVIDIA"

        elif (lspci | grep VGA | grep "Radeon R" &>/dev/null); then
            default_GPU="xf86-video-radeon"
            chipset="AMD RADEON"
            echo "RADEON"

        elif (lspci | grep VGA | grep "ATI" &>/dev/null); then
            default_GPU="xf86-video-ati"
            chipset="AMD/ATI"
            echo "ATI"

        elif (lspci | grep VGA | grep "Intel" &>/dev/null); then
            default_GPU="xf86-video-intel"
            chipset="Intel"
            echo "Intel"
        else
            #default_GPU="xf86-video-vesa"
            #chipset="Desconocido"
            echo nada
        fi